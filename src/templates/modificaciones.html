<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modificar Usuario</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos1.css') }}">
</head>

<body>
    <h1>Modificar Usuarios registrados</h1>
    <h3>Codo a Codo 2023</h3>
    <div id="app">
        <form id="usuarioForm">
            <label for="id">Id:</label>
            <input type="number" id="id" required><br>
            <button type="button" onclick="obtenerUsuario()">Modificar Usuario</button>
            <a href="{{ url_for('index')}}">Menu principal</a>
        </form>

        <div id="datosUsuario" style="display: none;">
            <h2>Datos del Usuario</h2>
            <form id="modificarForm">
                <label for="nombreModificar">Nombres:</label>
                <input type="text" id="nombreModificar" required><br>
    
                <label for="correoModificar">Correo:</label>
                <input type="email" id="correoModificar" required><br>
    
                <label for="nuevaFoto">Nueva Imagen:</label>
                <input type="file" id="nuevaFoto" onchange="mostrarVistaPrevia()"><br>
    
                <img id="vistaPrevia" style="max-width: 200px; display: none;">
    
                <label for="contraModificar">Contraseña:</label>
                <input type="password" id="contraModificar" required><br>
    
                <button type="button" onclick="guardarCambios()">Guardar Cambios</button>
                <a href="modificaciones.html">Cancelar</a>
            </form>
        </div>
    </div>

        <script>
            const URL = "http://127.0.0.1:5000/";
    
            function obtenerUsuario() {
                const id = document.getElementById('id').value;
    
                fetch(URL + 'usuarios/' + id)
                    
                    .then(response => {
                        console.log(response);
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById('nombreModificar').value = data[1];
                        document.getElementById('correoModificar').value = data[2];
                        document.getElementById('contraModificar').value = ''; // Puedes decidir si quieres mantener la contraseña actual
                        document.getElementById('datosUsuario').style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Agrega una alerta indicando que el usuario no se encontró
                        alert('Usuario no encontrado');

                    // Limpia los campos o realiza otras acciones según tus necesidades
                    limpiarFormulario();
                    });
            }
    
            function mostrarVistaPrevia() {
                const fileInput = document.getElementById('nuevaFoto');
                const vistaPrevia = document.getElementById('vistaPrevia');
    
                if (fileInput.files && fileInput.files[0]) {
                    const reader = new FileReader();
    
                    reader.onload = function (e) {
                        vistaPrevia.src = e.target.result;
                        vistaPrevia.style.display = 'block';
                    };
    
                    reader.readAsDataURL(fileInput.files[0]);
                }
            }
    
            function guardarCambios() {
                const id = document.getElementById('id').value;
                const nombre = document.getElementById('nombreModificar').value;
                const correo = document.getElementById('correoModificar').value;
                const contra = document.getElementById('contraModificar').value;
    
                const formData = new FormData();
                formData.append('id', id);
                formData.append('nombre', nombre);
                formData.append('correo', correo);
                formData.append('contra', contra); // Asegúrate de manejar esto en tu servidor
    
                const nuevaFotoInput = document.getElementById('nuevaFoto');
                if (nuevaFotoInput.files && nuevaFotoInput.files[0]) {
                    formData.append('foto', nuevaFotoInput.files[0], nuevaFotoInput.files[0].name);
                }
    
                fetch(URL + 'usuarios/' + id, {
                    method: 'PUT',
                    body: formData,
                })
                .then(response => {
                    console.log("respuesta",response);
                    return response.json();
                })
                    .then(data => {
                        alert('Usuario actualizado correctamente');
                        limpiarFormulario();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error al actualizar el usuario');
                    });
            }
    
            function limpiarFormulario() {
                document.getElementById('id').value = '';
                document.getElementById('nombreModificar').value = '';
                document.getElementById('correoModificar').value = '';
                document.getElementById('nuevaFoto').value = '';
                document.getElementById('vistaPrevia').style.display = 'none';
                document.getElementById('contraModificar').value = '';
                document.getElementById('datosUsuario').style.display = 'none';
            }
        </script>
    
    </body>
</html>